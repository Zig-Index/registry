{
  "name": "zig-msgpack",
  "owner": "zigcc",
  "repo": "zig-msgpack",
  "description": "zig messagpack implementation / msgpack.org[zig]",
  "type": "package",
  "topics": [
    "msgpack",
    "msgpack-rpc",
    "zig",
    "zig-package"
  ],
  "stars": 51,
  "forks": 5,
  "watchers": 2,
  "updated_at": "2026-02-23T22:27:37Z",
  "minimum_zig_version": "0.14.0",
  "readme": "# zig-msgpack\n\n[![CI](https://github.com/zigcc/zig-msgpack/actions/workflows/test.yml/badge.svg)](https://github.com/zigcc/zig-msgpack/actions/workflows/test.yml)\n\nA MessagePack implementation for the Zig programming language. This library provides a simple and efficient way to serialize and deserialize data using the MessagePack format.\n\nAn article introducing it: [Zig Msgpack](https://blog.nvimer.org/2025/09/20/zig-msgpack/)\n\n## Features\n\n- **Full MessagePack Support:** Implements all MessagePack types including the timestamp extension.\n- **Timestamp Support:** Complete implementation of MessagePack timestamp extension type (-1) with support for all three formats (32-bit, 64-bit, and 96-bit).\n- **Production-Safe Parser:** Iterative parser prevents stack overflow on deeply nested or malicious input.\n- **Security Hardened:** Configurable limits protect against DoS attacks (depth bombs, size bombs, etc.).\n- **Efficient:** Designed for high performance with minimal memory overhead.\n- **Type-Safe:** Leverages Zig's type system to ensure safety during serialization and deserialization.\n- **Simple API:** Offers a straightforward and easy-to-use API for encoding and decoding.\n- **Generic Map Keys:** Supports any Payload type as map keys, not limited to strings (uses efficient HashMap implementation).\n- **Performance Optimized:** Advanced optimizations including CPU cache prefetching, branch prediction hints, and SIMD operations for maximum throughput.\n- **Cross-Platform:** Tested and optimized for all major platforms (Windows, macOS, Linux) and architectures (x86_64, ARM64, etc.) with platform-specific optimizations.\n\n## Platform Support\n\nThis library is tested and optimized for all major platforms and architectures:\n\n| Platform | Architecture | CI Status | SIMD Optimizations |\n|----------|--------------|-----------|-------------------|\n| **Windows** | x86_64 | ‚úÖ Tested | SSE2/AVX2 prefetch |\n| **macOS** | ARM64 (Apple Silicon) | ‚úÖ Tested | ARM NEON + PRFM |\n| **Linux** | x86_64 | ‚úÖ Tested | SSE2/AVX2 prefetch |\n| **Linux** | ARM64/aarch64 | ‚úÖ Tested | ARM NEON + PRFM |\n| **Other** | RISC-V, MIPS, etc. | ‚úÖ Tested | Graceful fallback |\n\n### Architecture-Specific Optimizations\n\n- **x86/x64**: Utilizes SSE/AVX prefetch instructions (`PREFETCHT0/1/2`, `PREFETCHNTA`) for cache-aware memory access\n- **ARM64**: Uses ARM PRFM (Prefetch Memory) instructions for optimal performance on Apple Silicon and ARM servers\n- **Cross-platform**: Automatically detects CPU features at compile-time with zero runtime overhead\n- **Safe fallback**: Gracefully degrades to standard operations on unsupported architectures\n\n## Installation\n\n### Version Compatibility\n\n| Zig Version          | Library Version | Status                                |\n| -------------------- | --------------- | ------------------------------------- |\n| 0.13 and older       | 0.0.6           | Legacy support                        |\n| 0.14.0               | Current         | ‚úÖ Fully supported                    |\n| 0.15.x               | Current         | ‚úÖ Fully supported                    |\n| 0.16.0-dev (nightly) | Current         | ‚úÖ Supported with compatibility layer |\n\n> **Note:** For Zig 0.13 and older versions, please use version `0.0.6` of this library.\n> **Note:** Zig 0.16+ removes `std.io.FixedBufferStream`, but this library provides a compatibility layer to maintain the same API across all supported versions.\n\nFor Zig `0.14.0`, `0.15.x`, and `0.16.0-dev`, follow these steps:\n\n1.  **Add as a dependency:**\n    Add the library to your `build.zig.zon` file. You can fetch a specific commit or branch.\n\n    ```sh\n    zig fetch --save https://github.com/zigcc/zig-msgpack/archive/{COMMIT_OR_BRANCH}.tar.gz\n    ```\n\n2.  **Configure your `build.zig`:**\n    Add the `zig-msgpack` module to your executable.\n\n### Using std.io.Reader and std.io.Writer (Zig 0.15+)\n\nFor Zig 0.15 and later, you can use the convenient `PackerIO` API with standard I/O interfaces:\n\n```zig\nconst std = @import(\"std\");\nconst msgpack = @import(\"msgpack\");\n\npub fn main() !void {\n    var gpa = std.heap.GeneralPurposeAllocator(.{}){};\n    defer _ = gpa.deinit();\n    const allocator = gpa.allocator();\n\n    var buffer: [1024]u8 = undefined;\n\n    // Create Reader and Writer\n    var writer = std.Io.Writer.fixed(&buffer);\n    var reader = std.Io.Reader.fixed(&buffer);\n\n    // Create packer using the convenient PackerIO\n    var packer = msgpack.PackerIO.init(&reader, &writer);\n\n    // Create and encode data\n    var map = msgpack.Payload.mapPayload(allocator);\n    defer map.free(allocator);\n    try map.mapPut(\"name\", try msgpack.Payload.strToPayload(\"Alice\", allocator));\n    try map.mapPut(\"age\", msgpack.Payload.uintToPayload(30));\n    try packer.write(map);\n\n    // Decode\n    reader.seek = 0;\n    const decoded = try packer.read(allocator);\n    defer decoded.free(allocator);\n\n    const name = (try decoded.mapGet(\"name\")).?.str.value();\n    const age = (try decoded.mapGet(\"age\")).?.uint;\n    std.debug.print(\"Name: {s}, Age: {d}\\n\", .{ name, age });\n}\n```\n\nYou can also use the convenience function:\n\n```zig\nvar packer = msgpack.packIO(&reader, &writer);\n```\n\n### Working with Files\n\n```zig\nconst std = @import(\"std\");\nconst msgpack = @import(\"msgpack\");\n\npub fn main() !void {\n    var gpa = std.heap.GeneralPurposeAllocator(.{}){};\n    defer _ = gpa.deinit();\n    const allocator = gpa.allocator();\n\n    // Open file for reading and writing\n    var file = try std.fs.cwd().createFile(\"data.msgpack\", .{ .read = true });\n    defer file.close();\n\n    // Create reader and writer with buffers\n    var reader_buf: [4096]u8 = undefined;\n    var reader = file.reader(&reader_buf);\n    var writer_buf: [4096]u8 = undefined;\n    var writer = file.writer(&writer_buf);\n\n    var packer = msgpack.PackerIO.init(&reader, &writer);\n\n    // Serialize data\n    var payload = msgpack.Payload.mapPayload(allocator);\n    defer payload.free(allocator);\n    try payload.mapPut(\"message\", try msgpack.Payload.strToPayload(\"Hello, MessagePack!\", allocator));\n    try packer.write(payload);\n\n    // Flush and seek back to start\n    try writer.flush();\n    try file.seekTo(0);\n    reader.seek = 0;\n    reader.end = 0;\n\n    // Deserialize\n    const decoded = try packer.read(allocator);\n    defer decoded.free(allocator);\n\n    const message = (try decoded.mapGet(\"message\")).?.str.value();\n    std.debug.print(\"Message: {s}\\n\", .{message});\n}\n```\n\n### Basic Usage (All Zig Versions)\n\nFor maximum compatibility or when you need more control, use the generic `Pack` API:\n\n    ```zig\n    const std = @import(\"std\");\n\n    pub fn build(b: *std.Build) void {\n        const target = b.standardTargetOptions(.{});\n        const optimize = b.standardOptimizeOption(.{});\n\n        const exe = b.addExecutable(.{\n            .name = \"my-app\",\n            .root_source_file = .{ .path = \"src/main.zig\" },\n            .target = target,\n            .optimize = optimize,\n        });\n\n        const msgpack_dep = b.dependency(\"zig_msgpack\", .{\n            .target = target,\n            .optimize = optimize,\n        });\n\n        exe.root_module.addImport(\"msgpack\", msgpack_dep.module(\"msgpack\"));\n\n        b.installArtifact(exe);\n    }\n    ```\n\n## Usage\n\n### Using std.io.Reader and std.io.Writer (Zig 0.15+)\n\nFor Zig 0.15 and later, you can use the convenient `PackerIO` API with standard I/O interfaces:\n\n```zig\nconst std = @import(\"std\");\nconst msgpack = @import(\"msgpack\");\n\npub fn main() !void {\n    var gpa = std.heap.GeneralPurposeAllocator(.{}){};\n    defer _ = gpa.deinit();\n    const allocator = gpa.allocator();\n\n    var buffer: [1024]u8 = undefined;\n\n    // Create Reader and Writer\n    var writer = std.Io.Writer.fixed(&buffer);\n    var reader = std.Io.Reader.fixed(&buffer);\n\n    // Create packer using the convenient PackerIO\n    var packer = msgpack.PackerIO.init(&reader, &writer);\n\n    // Create and encode data\n    var map = msgpack.Payload.mapPayload(allocator);\n    defer map.free(allocator);\n    try map.mapPut(\"name\", try msgpack.Payload.strToPayload(\"Alice\", allocator));\n    try map.mapPut(\"age\", msgpack.Payload.uintToPayload(30));\n    try packer.write(map);\n\n    // Decode\n    reader.seek = 0;\n    const decoded = try packer.read(allocator);\n    defer decoded.free(allocator);\n\n    const name = (try decoded.mapGet(\"name\")).?.str.value();\n    const age = (try decoded.mapGet(\"age\")).?.uint;\n    std.debug.print(\"Name: {s}, Age: {d}\\n\", .{ name, age });\n}\n```\n\nYou can also use the convenience function:\n\n```zig\nvar packer = msgpack.packIO(&reader, &writer);\n```\n\n### Working with Files\n\n```zig\nconst std = @import(\"std\");\nconst msgpack = @import(\"msgpack\");\n\npub fn main() !void {\n    var gpa = std.heap.GeneralPurposeAllocator(.{}){};\n    defer _ = gpa.deinit();\n    const allocator = gpa.allocator();\n\n    // Open file for reading and writing\n    var file = try std.fs.cwd().createFile(\"data.msgpack\", .{ .read = true });\n    defer file.close();\n\n    // Create reader and writer with buffers\n    var reader_buf: [4096]u8 = undefined;\n    var reader = file.reader(&reader_buf);\n    var writer_buf: [4096]u8 = undefined;\n    var writer = file.writer(&writer_buf);\n\n    var packer = msgpack.PackerIO.init(&reader, &writer);\n\n    // Serialize data\n    var payload = msgpack.Payload.mapPayload(allocator);\n    defer payload.free(allocator);\n    try payload.mapPut(\"message\", try msgpack.Payload.strToPayload(\"Hello, MessagePack!\", allocator));\n    try packer.write(payload);\n\n    // Flush and seek back to start\n    try writer.flush();\n    try file.seekTo(0);\n    reader.seek = 0;\n    reader.end = 0;\n\n    // Deserialize\n    const decoded = try packer.read(allocator);\n    defer decoded.free(allocator);\n\n    const message = (try decoded.mapGet(\"message\")).?.str.value();\n    std.debug.print(\"Message: {s}\\n\", .{message});\n}\n```\n\n### Basic Usage (All Zig Versions)\n\nFor maximum compatibility or when you need more control, use the generic `Pack` API:\n\n```zig\nconst std = @import(\"std\");\nconst msgpack = @import(\"msgpack\");\n\npub fn main() !void {\n    const allocator = std.heap.page_allocator;\n    var buffer: [1024]u8 = undefined;\n\n    // Use the compatibility layer for cross-version support\n    const compat = msgpack.compat;\n    var write_buffer = compat.fixedBufferStream(&buffer);\n    var read_buffer = compat.fixedBufferStream(&buffer);\n\n    const BufferType = compat.BufferStream;\n    var packer = msgpack.Pack(\n        *BufferType, *BufferType,\n        BufferType.WriteError, BufferType.ReadError,\n        BufferType.write, BufferType.read,\n    ).init(&write_buffer, &read_buffer);\n\n    // Create and encode data\n    var map = msgpack.Payload.mapPayload(allocator);\n    defer map.free(allocator);\n    try map.mapPut(\"name\", try msgpack.Payload.strToPayload(\"Alice\", allocator));\n    try map.mapPut(\"age\", msgpack.Payload.uintToPayload(30));\n    try packer.write(map);\n\n    // Decode\n    read_buffer.pos = 0;\n    const decoded = try packer.read(allocator);\n    defer decoded.free(allocator);\n\n    const name = (try decoded.mapGet(\"name\")).?.str.value();\n    const age = (try decoded.mapGet(\"age\")).?.uint;\n    std.debug.print(\"Name: {s}, Age: {d}\\n\", .{ name, age });\n}\n```\n\n### Data Types\n\n```zig\n// Basic types\nconst nil_val = msgpack.Payload.nilToPayload();\nconst bool_val = msgpack.Payload.boolToPayload(true);\nconst int_val = msgpack.Payload.intToPayload(-42);\nconst uint_val = msgpack.Payload.uintToPayload(42);\nconst float_val = msgpack.Payload.floatToPayload(3.14);\n\n// String and binary\nconst str_val = try msgpack.Payload.strToPayload(\"hello\", allocator);\nconst bin_val = try msgpack.Payload.binToPayload(&[_]u8{1, 2, 3}, allocator);\n\n// Array\nvar arr = try msgpack.Payload.arrPayload(2, allocator);\ntry arr.setArrElement(0, msgpack.Payload.intToPayload(1));\ntry arr.setArrElement(1, msgpack.Payload.intToPayload(2));\n\n// Extension type\nconst ext_val = try msgpack.Payload.extToPayload(5, &[_]u8{0xaa, 0xbb}, allocator);\n\n// Map with string keys (backward compatible)\nvar map = msgpack.Payload.mapPayload(allocator);\ntry map.mapPut(\"key1\", msgpack.Payload.intToPayload(42));\n\n// Map with any type keys (new feature)\nvar generic_map = msgpack.Payload.mapPayload(allocator);\ntry generic_map.mapPutGeneric(msgpack.Payload.intToPayload(1), msgpack.Payload.strToPayload(\"value1\", allocator));\ntry generic_map.mapPutGeneric(msgpack.Payload.boolToPayload(true), msgpack.Payload.strToPayload(\"true_value\", allocator));\n```\n\n### Using Organized Constants\n\nThe library provides semantic constant structures for better code clarity:\n\n```zig\n// MessagePack format limits\nconst max_fixstr = msgpack.FixLimits.STR_LEN_MAX;  // 31\nconst max_fixarray = msgpack.FixLimits.ARRAY_LEN_MAX;  // 15\n\n// Integer bounds\nconst uint8_max = msgpack.IntBounds.UINT8_MAX;  // 0xff\nconst int8_min = msgpack.IntBounds.INT8_MIN;  // -128\n\n// Fixed extension lengths\nconst ext4_len = msgpack.FixExtLen.EXT4;  // 4\n\n// Timestamp constants\nconst ts_type = msgpack.TimestampExt.TYPE_ID;  // -1\nconst ts32_len = msgpack.TimestampExt.FORMAT32_LEN;  // 4\nconst max_nano = msgpack.TimestampExt.NANOSECONDS_MAX;  // 999_999_999\n\n// Marker base values\nconst fixarray_base = msgpack.MarkerBase.FIXARRAY;  // 0x90\nconst fixstr_mask = msgpack.MarkerBase.FIXSTR_LEN_MASK;  // 0x1f\n```\n\n### Timestamp Usage\n\n```zig\n// Create timestamps\nconst ts1 = msgpack.Payload.timestampFromSeconds(1234567890);\nconst ts2 = msgpack.Payload.timestampToPayload(1234567890, 123456789);\n\n// Write and read timestamp\ntry packer.write(ts2);\nread_buffer.pos = 0;\nconst decoded_ts = try packer.read(allocator);\ndefer decoded_ts.free(allocator);\n\nstd.debug.print(\"Timestamp: {}s + {}ns\\n\",\n    .{ decoded_ts.timestamp.seconds, decoded_ts.timestamp.nanoseconds });\nstd.debug.print(\"As float: {d}\\n\", .{ decoded_ts.timestamp.toFloat() });\n```\n\n### Error Handling\n\n```zig\n// Type conversion with error handling\nconst int_payload = msgpack.Payload.intToPayload(-42);\nconst uint_result = int_payload.getUint() catch |err| switch (err) {\n    msgpack.MsgPackError.InvalidType => {\n        std.debug.print(\"Cannot convert negative to unsigned\\n\");\n        return;\n    },\n    else => return err,\n};\n\n// Strict type conversion (no auto-conversion)\nconst strict_int = payload.asInt() catch |err| {\n    // Only accepts .int type, rejects .uint even if it fits\n    return err;\n};\n\n// Type checking\nif (payload.isNil()) {\n    std.debug.print(\"Value is nil\\n\", .{});\n}\nif (payload.isNumber()) {\n    std.debug.print(\"Value is a number (int/uint/float)\\n\", .{});\n}\nif (payload.isInteger()) {\n    std.debug.print(\"Value is an integer (int/uint)\\n\", .{});\n}\n```\n\n### Security Features (Parsing Untrusted Data)\n\nThe library includes configurable safety limits to protect against malicious or corrupted MessagePack data:\n\n```zig\n// Default limits (recommended for most use cases)\nconst Packer = msgpack.Pack(\n    *Writer, *Reader,\n    Writer.Error, Reader.Error,\n    Writer.write, Reader.read,\n);\n// Automatically protected against:\n// - Deep nesting attacks (max 1000 layers)\n// - Large array/map attacks (max 1M elements)\n// - Memory exhaustion (max 100MB strings)\n\n// Custom limits for specific environments\nconst StrictPacker = msgpack.PackWithLimits(\n    *Writer, *Reader,\n    Writer.Error, Reader.Error,\n    Writer.write, Reader.read,\n    .{\n        .max_depth = 50,              // Limit nesting to 50 layers\n        .max_array_length = 10_000,   // Max 10K array elements\n        .max_map_size = 10_000,       // Max 10K map pairs\n        .max_string_length = 1024 * 1024,  // Max 1MB strings\n        .max_bin_length = 1024 * 1024,     // Max 1MB binary blobs\n        .max_ext_length = 512 * 1024,      // Max 512KB extension data\n    },\n);\n```\n\n**Security Guarantees:**\n\n- ‚úÖ **Never crashes** on malformed or malicious input\n- ‚úÖ **No stack overflow** regardless of nesting depth (iterative parser)\n- ‚úÖ **Bounded memory usage** with configurable limits\n- ‚úÖ **Fast rejection** of invalid data (no resource exhaustion)\n\nPossible security errors:\n\n```zig\nmsgpack.MsgPackError.MaxDepthExceeded    // Nesting too deep\nmsgpack.MsgPackError.ArrayTooLarge       // Array claims too many elements\nmsgpack.MsgPackError.MapTooLarge         // Map claims too many pairs\nmsgpack.MsgPackError.StringTooLong       // String data too large\nmsgpack.MsgPackError.BinDataLengthTooLong // Binary blob too large\nmsgpack.MsgPackError.ExtDataTooLarge     // Extension payload too large\n```\n\n## API Overview\n\n- **`msgpack.Pack`**: The main struct for packing and unpacking MessagePack data with default safety limits.\n- **`msgpack.PackWithLimits`**: Create a packer with custom safety limits for specific security requirements.\n- **`msgpack.Payload`**: A union that represents any MessagePack type. It provides methods for creating and interacting with different data types (e.g., `mapPayload`, `strToPayload`, `mapGet`).\n- **`msgpack.PackerIO`**: (Zig 0.15+) Convenient wrapper for working with `std.io.Reader` and `std.io.Writer`.\n- **`msgpack.packIO`**: (Zig 0.15+) Convenience function to create a `PackerIO` instance.\n- **`msgpack.ParseLimits`**: Configuration struct for parser safety limits.\n- **Constant Structures**: `FixLimits`, `IntBounds`, `FixExtLen`, `TimestampExt`, `MarkerBase` - organized constants for better code clarity.\n\n### Type Conversion Methods\n\n**Lenient conversion** (allows type conversion):\n- `getInt()` - uint can be converted to i64 if it fits\n- `getUint()` - positive int can be converted to u64\n\n**Strict conversion** (no type conversion):\n- `asInt()`, `asUint()`, `asFloat()`, `asBool()`, `asStr()`, `asBin()`\n\n**Type checking**:\n- `isNil()`, `isNumber()`, `isInteger()`\n\n### Map Operations\n\n**String keys** (backward compatible):\n- `mapPut(key: []const u8, value: Payload)`\n- `mapGet(key: []const u8) ?Payload`\n\n**Generic keys** (any Payload type):\n- `mapPutGeneric(key: Payload, value: Payload)`\n- `mapGetGeneric(key: Payload) ?Payload`\n\n## Implementation Notes\n\n### Security Architecture\n\nThis library uses an **iterative parser** (not recursive) to provide strong security guarantees:\n\n**Iterative Parsing:**\n\n- Parser uses an explicit stack (on heap) instead of recursive function calls\n- Stack depth remains constant regardless of input nesting depth\n- Prevents stack overflow attacks completely\n\n**Safety Limits:**\n\n- All limits are enforced **before** memory allocation\n- Invalid input is rejected immediately without resource consumption\n- Configurable limits allow tuning for specific environments (embedded, server, etc.)\n\n**Memory Safety:**\n\n- All error paths include complete cleanup (`errdefer` + `cleanupParseStack`)\n- Zero memory leaks verified by GPA (General Purpose Allocator) in tests\n- Safe to parse untrusted data from network, files, or user input\n\n### Zig 0.16 Compatibility\n\nStarting from Zig 0.16, the standard library underwent significant changes to the I/O subsystem. The `std.io.FixedBufferStream` was removed as part of a broader redesign. This library includes a compatibility layer (`src/compat.zig`) that:\n\n- Provides a `BufferStream` implementation for Zig 0.16+ that mimics the behavior of the old `FixedBufferStream`\n- Uses conditional compilation to maintain backward compatibility with Zig 0.14 and 0.15\n- Ensures all existing functionality works seamlessly across different Zig versions\n\nThis means you can use the same API regardless of your Zig version, and the library will handle the differences internally.\n\n## Testing\n\nTo run the unit tests for this library, use the following command:\n\n```sh\nzig build test\n\n# For more detailed test output\nzig build test --summary all\n```\n\nThe comprehensive test suite includes:\n\n- **87 tests** covering all functionality\n- **Malicious data tests:** Verify protection against crafted attacks (billion-element arrays, extreme nesting, etc.)\n- **Fuzz tests:** Random input validation ensures no crashes on arbitrary data\n- **Large data tests:** Arrays with 1000+ elements, maps with 500+ pairs\n- **Memory safety:** Zero leaks verified by strict allocator testing\n\n## Benchmarks\n\nTo run performance benchmarks:\n\n```sh\n# Run benchmarks (default build mode)\nzig build bench\n\n# Run with optimizations for accurate performance measurements\nzig build bench -Doptimize=ReleaseFast\n```\n\nThe benchmark suite includes:\n\n- Basic types (nil, bool, integers, floats)\n- Strings and binary data of various sizes\n- Arrays and maps (small, medium, large)\n- Extension types and timestamps\n- Nested structures and mixed-type payloads\n\nOutput provides throughput (ops/sec) and latency (ns/op) metrics for each operation.\n\n## Documentation\n\nTo generate documentation for this library:\n\n```sh\nzig build docs\n```\n\n## Contributing\n\nContributions are welcome! Please feel free to open an issue or submit a pull request.\n\n## Performance\n\nThis library is heavily optimized for performance across all supported platforms. The optimizations are architecture-aware and automatically adapt to your target platform at compile time.\n\n### Optimization Features\n\n1. **CPU Cache Prefetching**\n   - Platform-specific prefetch instructions (x86: `PREFETCH*`, ARM: `PRFM`)\n   - Intelligently prefetches data before it's needed for containers ‚â•256 bytes\n   - Multi-level cache hints (L1/L2/L3) for optimal cache utilization\n   - Streaming prefetch for non-temporal data access\n\n2. **SIMD Operations**\n   - Automatic detection of available SIMD features (AVX-512, AVX2, SSE2, NEON)\n   - Vectorized string comparison (16-64 byte chunks)\n   - Vectorized memory copying with alignment optimization\n   - Vectorized byte order conversion (big-endian ‚Üî little-endian)\n   - Batch integer array conversions (u32/u64)\n\n3. **Memory Alignment Optimization**\n   - Automatic alignment detection and fast path selection\n   - Aligned memory reads/writes for supported types\n   - Memory alignment preprocessing for better SIMD performance\n   - Large data copy optimization (‚â•64 bytes)\n\n4. **Branch Prediction Optimization**\n   - Hot path annotations for common cases\n   - Lookup tables for O(1) marker byte conversion (256-entry precomputed table)\n   - Switch expressions instead of if-else chains (jump table optimization)\n   - Optimized error handling paths\n\n5. **HashMap-Based Maps**\n   - O(1) average-case key lookups (vs O(n) linear search)\n   - Efficient hash function with depth limiting\n   - Support for any Payload type as keys\n   - `getOrPut` optimization (single hash computation)\n\n### Performance Characteristics\n\nMeasured performance improvements over baseline implementations:\n\n| Operation Type           | Performance Gain | Throughput              | Key Optimizations                        |\n| ------------------------ | ---------------- | ----------------------- | ---------------------------------------- |\n| Small/Simple Data        | 5-10%            | ~20M ops/sec            | Branch prediction, lookup tables         |\n| Large Strings (‚â•256B)    | 15-25%           | ~2-5 GB/s               | Prefetching, SIMD comparison             |\n| Large Binary (‚â•256B)     | 15-25%           | ~3-6 GB/s               | Prefetching, SIMD memcpy                 |\n| Integer Arrays (100+)    | 10-20%           | ~500K-1M arrays/sec     | Batch conversion, prefetching            |\n| Map Lookups (100+ keys)  | 50-90%           | ~5-10M lookups/sec      | HashMap O(1) vs linear O(n)              |\n| Nested Structures        | 8-15%            | ~100K-500K structs/sec  | Combined optimizations                   |\n| Mixed Type Data          | 10-15%           | Varies by data          | Adaptive optimizations                   |\n\n> **Note:** Performance varies by platform, CPU model, data size, and compiler optimization level (`ReleaseFast` vs `ReleaseSafe`).\n> Measurements taken on modern CPUs (Intel Core i7/i9, Apple M1/M2, AMD Ryzen).\n\n### Platform-Specific Optimizations\n\n| Platform | SIMD Features | Prefetch Instructions | String Comparison | Memory Copy |\n|----------|---------------|----------------------|-------------------|-------------|\n| **x86_64 (AVX-512)** | 512-bit vectors | `PREFETCHT0/1/2/NTA` | 64-byte chunks | 64-byte chunks |\n| **x86_64 (AVX2)** | 256-bit vectors | `PREFETCHT0/1/2/NTA` | 32-byte chunks | 32-byte chunks |\n| **x86_64 (SSE2)** | 128-bit vectors | `PREFETCHT0/1/2/NTA` | 16-byte chunks | 16-byte chunks |\n| **ARM64 (NEON)** | 128-bit vectors | `PRFM PLD/PST` | 16-byte chunks | 16-byte chunks |\n| **Other** | Scalar fallback | No prefetch | Standard `memcmp` | Standard `memcpy` |\n\nAll optimizations are **compile-time detected** with zero runtime overhead. The library automatically uses the best available features for your target platform.\n\n### Running Performance Tests\n\n```sh\n# Standard benchmark suite\nzig build bench -Doptimize=ReleaseFast\n\n# Sample output:\n# Benchmark Name                           | Iterations | ns/op    | ops/sec\n# ------------------------------------------------------------------------\n# Nil Write                                |  1000000   |       45 |  22222222\n# Small Int Write                          |  1000000   |       52 |  19230769\n# Large String Write (1KB)                 |   100000   |     1250 |    800000\n# Map Lookup (100 keys)                    |   500000   |      180 |   5555555\n```\n\n## Related Projects\n\n- [getty-msgpack](https://git.mzte.de/LordMZTE/getty-msgpack)\n- [znvim](https://github.com/jinzhongjia/znvim)\n\n## License\n\nThis project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.\n",
  "owner_avatar_url": "https://avatars.githubusercontent.com/u/109492796?v=4",
  "releases": [
    {
      "tag_name": "0.0.16",
      "name": "0.0.16",
      "body": "# Release 0.0.16\r\n\r\n## New Features\r\n\r\n- **PackerIO API**: Added `PackerIO` wrapper for convenient integration with `std.io.Reader` and `std.io.Writer` interfaces\r\n- **packIO() convenience function**: Quick initialization helper for creating PackerIO instances\r\n\r\n## Testing\r\n\r\n- Added comprehensive test suite with 30+ test cases for PackerIO functionality\r\n\r\n## Documentation\r\n\r\n- Updated documentation with I/O usage examples and performance optimization details\r\n- Updated CI badge references and platform support information\r\n\r\n---\r\n\r\n**Note**: PackerIO requires Zig 0.15 or later.\r\n\r\n",
      "prerelease": false,
      "published_at": "2025-11-02T03:01:28Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.16",
      "assets": []
    },
    {
      "tag_name": "0.0.15",
      "name": "0.0.15",
      "body": "# zig-msgpack 0.0.15 Release Notes\r\n\r\n## Overview\r\n\r\nPerformance-focused release with 5-90% speed improvements, enhanced security features, and Zig 0.16 support. Fully backward compatible with 0.0.14.\r\n\r\n## Performance Optimizations\r\n\r\n### CPU Cache Prefetching\r\n- x86/x64: SSE/AVX prefetch instructions (`PREFETCHT0/1/2`, `PREFETCHNTA`)\r\n- ARM64: ARM PRFM instructions for Apple Silicon and ARM servers\r\n- 10-20% faster for large strings/binary, 8-15% faster for large arrays/maps\r\n- Compile-time feature detection, zero runtime overhead\r\n\r\n### SIMD & Parser Optimizations\r\n- SIMD-accelerated integer operations, string comparison, memory copying\r\n- O(1) lookup table for marker byte conversion\r\n- HashMap replaces ArrayList for map storage (10√ó faster lookups)\r\n- Branch prediction hints for hot paths\r\n\r\n## Security Features\r\n\r\n### Iterative Parser with Configurable Limits\r\n- Prevents stack overflow on deeply nested input\r\n- Protection against DoS attacks (depth bombs, size bombs)\r\n- Default limits: 1K depth, 1M elements, 100MB strings/binary\r\n\r\n```zig\r\nconst StrictPacker = msgpack.PackWithLimits(\r\n    *Writer, *Reader,\r\n    Writer.Error, Reader.Error,\r\n    Writer.write, Reader.read,\r\n    .{\r\n        .max_depth = 50,\r\n        .max_array_length = 10_000,\r\n        .max_map_size = 10_000,\r\n        .max_string_length = 1024 * 1024,\r\n        .max_bin_length = 1024 * 1024,\r\n        .max_ext_length = 512 * 1024,\r\n    },\r\n);\r\n```\r\n\r\n## Platform Support\r\n\r\n- **OS**: Windows, macOS (Intel/ARM), Linux\r\n- **Architectures**: x86_64, ARM64, RISC-V, MIPS\r\n- **Zig Versions**: 0.14.0, 0.15.x, 0.16.0-dev\r\n- 87 tests across all platform combinations\r\n\r\n## New Features\r\n\r\n### Timestamp API\r\n```zig\r\nconst ts = Timestamp.fromNanos(1234567890123456789);\r\n```\r\n\r\n### Zig 0.16 Compatibility\r\n- New `src/compat.zig` compatibility layer\r\n- Drop-in `BufferStream` replacement for removed `std.io.FixedBufferStream`\r\n- Same API across Zig 0.14-0.16\r\n\r\n## Performance Benchmarks (ReleaseFast)\r\n\r\n| Operation | 0.0.14 | 0.0.15 | Improvement |\r\n|-----------|--------|--------|-------------|\r\n| Large strings (300B) | ~12 ¬µs/op | ~10 ¬µs/op | +20% |\r\n| Large binary (1KB) | ~8 ¬µs/op | ~6.7 ¬µs/op | +16% |\r\n| Medium arrays (100) | ~19 ¬µs/op | ~16.7 ¬µs/op | +12% |\r\n| Medium maps (50) | ~520 ¬µs/op | ~48 ¬µs/op | +90% |\r\n| Nested structures | ~17 ¬µs/op | ~13 ¬µs/op | +23% |\r\n\r\n## Bug Fixes\r\n\r\n- Enhanced validation for malformed data\r\n- Fixed integer boundary edge cases\r\n- Improved security limit error messages\r\n- Removed unused parameters\r\n\r\n## No Breaking Changes\r\n\r\nNone. Fully backward compatible with 0.0.14.\r\n\r\n## Migration\r\n\r\n```sh\r\nzig fetch --save https://github.com/zigcc/zig-msgpack/archive/v0.0.15.tar.gz\r\n```\r\n\r\n## Changelog\r\n\r\n**Features**\r\n- Multi-architecture CPU cache prefetch (x86/ARM)\r\n- SIMD integer optimizations\r\n- Configurable security limits (`PackWithLimits` API)\r\n- `Timestamp.fromNanos()` method\r\n- Generic map keys with SIMD\r\n- Cross-platform CI testing\r\n\r\n**Performance**\r\n- HashMap replaces ArrayList for maps\r\n- Parser lookup table optimization\r\n- Hot path branch prediction hints\r\n- Optimized array initialization\r\n\r\n**Compatibility**\r\n- Zig 0.16 compatibility layer (`src/compat.zig`)\r\n- CI matrix for Zig 0.14, 0.15, 0.16\r\n\r\n**Infrastructure**\r\n- Architecture matrix CI (x86_64, ARM64)\r\n- Cross-platform testing (Windows, macOS, Linux)\r\n- Automated benchmarking\r\n\r\n",
      "prerelease": false,
      "published_at": "2025-11-01T17:16:37Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.15",
      "assets": []
    },
    {
      "tag_name": "0.0.14",
      "name": "0.0.14",
      "body": "# Version 0.0.14\r\n\r\n## Key Changes\r\n\r\n### Security and Stability\r\n- Converted recursive parser to iterative implementation with configurable safety limits to prevent stack overflow attacks\r\n- Added ParseLimits struct with controls for `max_depth`, `max_array_length`, `max_map_size,` `max_string_length`, and `max_ext_length`\r\n- Introduced `PackWithLimits()` function for custom limit configuration with backward-compatible `Pack()` wrapper\r\n- Refactored `Payload.free()` to iterative stack-based implementation\r\n- Added new error types for limit violations (`MaxDepthExceeded`, `ArrayTooLarge`, `MapTooLarge`, `StringTooLong`, `ExtDataTooLong`)\r\n- Comprehensive test suite for deep nesting, malicious payloads, and corrupted data\r\n\r\n### Performance\r\n- Added complete performance benchmarking suite (`bench.zig`)\r\n- Benchmarks cover all MessagePack operations in both debug and optimized builds\r\n- Detailed throughput and latency metrics available\r\n\r\n### Documentation\r\n- Updated README with security features and parsing limits\r\n- Added security architecture section explaining iterative parsing and memory safety\r\n- Documented PackWithLimits and ParseLimits API\r\n- Fixed error naming from MsGPackError to MsgPackError for consistency\r\n\r\n## Breaking Changes\r\nNone. The new `PackWithLimits()` function is an addition, and `Pack()` maintains backward compatibility.",
      "prerelease": false,
      "published_at": "2025-10-23T11:47:03Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.14",
      "assets": []
    },
    {
      "tag_name": "0.0.13",
      "name": "0.0.13",
      "body": "## Release 0.0.13 (0.0.12 ‚Üí 0.0.13)\r\n\r\n**üìä Statistics**: 12 commits\r\n\r\n### ‚ú® New Features\r\n- Utilizing the inherent characteristics of zig to achieve some performance improvements\r\n- **Performance Benchmarking Suite**: Added comprehensive benchmarking system (`bench.zig`)\r\n  - Covers serialization/deserialization performance for all major types\r\n  - Provides throughput and latency metrics\r\n  - Supports performance comparison for different container sizes\r\n\r\n### üß™ Testing Improvements\r\n- **Fuzz Testing**: Added comprehensive fuzz testing suite for improved robustness\r\n- **Constant Validation**: Added complete constant validation tests\r\n\r\n### üîß Refactoring & Optimization\r\n- **Parsing Logic Optimization**: Optimized extension type and timestamp parsing logic\r\n- **Integer Read/Write Simplification**: Simplified integer read/write methods, reduced code duplication\r\n- **Type Conversion Enhancement**: Improved Payload type conversion with enhanced type safety\r\n- **Constant Organization**: Replaced magic numbers with named constants for better readability\r\n- **Error Naming Standardization**: Unified error naming conventions\r\n- **Code Formatting Standardization**: Standardized indentation and spacing style\r\n\r\n### üìö Documentation\r\n- **AGENT.md**: Added comprehensive LLM code reading guidelines\r\n\r\n### üë• Contributors\r\n- jinzhongjia (12 commits)\r\n\r\n",
      "prerelease": false,
      "published_at": "2025-10-18T08:29:58Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.13",
      "assets": []
    },
    {
      "tag_name": "0.0.12",
      "name": "0.0.12",
      "body": "## Release Notes: v0.0.12\r\n\r\n### üéâ Release Overview\r\n\r\nTag `0.0.12` has been successfully created and pushed to the remote repository!\r\n\r\n### üìã Version Information\r\n- **Version**: 0.0.11 ‚Üí 0.0.12  \r\n- **Release Date**: September 22, 2025\r\n- **Total Commits**: 7\r\n\r\n### ‚ú® New Features\r\n\r\n#### Enhanced Zig 0.16 Compatibility Support\r\n- **feat(zig-compat)**: Enhance cross-version support for Zig 0.16 (5e0c70e)\r\n  - Added compatibility layer for removed `std.io.FixedBufferStream`\r\n  - Exported compatibility module in main msgpack module\r\n  - Updated example code to use cross-version buffer stream implementation\r\n  - Modified test imports to use new compatibility layer\r\n\r\n- **feat(zig-compat)**: Add compatibility layer for multiple Zig versions (f942c1d)\r\n  - Introduced `compat.zig` to handle standard library differences across Zig versions\r\n  - Implemented cross-version BufferStream to replace FixedBufferStream\r\n  - Support for Zig 0.14.1, 0.15.1, and master versions\r\n\r\n### üîß Improvements\r\n\r\n#### Code Refactoring and Quality\r\n- **refactor(msgpack)**: Improve code readability and add comprehensive tests (0b417fc)\r\n  - Enhanced code structure and maintainability\r\n  - Extended test coverage\r\n\r\n#### Documentation Updates  \r\n- **docs(readme)**: Update Zig 0.16 compatibility status (fa65a5e)\r\n- **docs(readme)**: Update version compatibility and Zig 0.16 support notes (5b4eea8)\r\n- Updated README.md and README_CN.md documentation (f9cf587, 8308c6d)\r\n\r\n### üöÄ Key Improvements\r\n\r\n1. **Cross-Version Compatibility**: Library now works seamlessly across Zig 0.14.0, 0.15.x, and 0.16.0-dev\r\n2. **API Stability**: Maintains consistent API across versions through compatibility layer\r\n3. **Better Documentation**: Updated both English and Chinese documentation with clearer version compatibility information\r\n\r\n### üìä Statistics\r\n- **Commits**: 7\r\n- **Contributors**: 1 (jinzhongjia)  \r\n- **Files Changed**: README.md, README_CN.md, src/msgpack.zig, src/test.zig, src/compat.zig\r\n\r\n### üí° Upgrade Guide\r\n\r\nUpgrading from v0.0.11 to v0.0.12 is safe with no breaking changes. If you're using Zig 0.16+, it's recommended to use the new compatibility layer API:\r\n\r\n```zig\r\n// Use compatibility layer for cross-version support\r\nconst compat = msgpack.compat;\r\nvar write_buffer = compat.fixedBufferStream(&buffer);\r\nvar read_buffer = compat.fixedBufferStream(&buffer);\r\n```\r\n\r\n### üîó Links\r\n- [Full Changelog](https://github.com/zigcc/zig-msgpack/compare/0.0.11...0.0.12)\r\n\r\n",
      "prerelease": false,
      "published_at": "2025-09-22T06:36:07Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.12",
      "assets": []
    },
    {
      "tag_name": "0.0.11",
      "name": "0.0.11",
      "body": "# Release Notes: 0.0.10 ‚Üí 0.0.11\r\n\r\n## Changes (3 commits)\r\n\r\n### ‚ú® New Features\r\n\r\n- feat(zig-compat): add compatibility layer for multiple Zig versions (f942c1d)\r\n\r\n### üìù Other Changes\r\n\r\n- Add Claude instruction file for the codebase (f61843d)\r\n- chore(ci): add Zig 0.15.1 to CI matrix and version checks (0222e07)\r\n\r\n### üë• Contributors\r\n\r\n- jinzhongjia (3 commits)",
      "prerelease": false,
      "published_at": "2025-09-14T16:33:20Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.11",
      "assets": []
    },
    {
      "tag_name": "0.0.10",
      "name": "0.0.10",
      "body": "# Release Notes: 0.0.9 ‚Üí 0.0.10\r\n\r\n## Changes (1 commits)\r\n\r\n### üêõ Bug Fixes\r\n\r\n- fix(test): support ArrayList API changes in Zig 0.15+ (f9113d9)\r\n\r\n### üë• Contributors\r\n\r\n- jinzhongjia (1 commits)\r\n\r\n",
      "prerelease": false,
      "published_at": "2025-08-16T16:41:46Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.10",
      "assets": []
    },
    {
      "tag_name": "0.0.9",
      "name": "0.0.9",
      "body": "### Summary\r\nAdded comprehensive MessagePack timestamp extension type (-1) support and significantly expanded test coverage for the zig-msgpack library.\r\n\r\n### Key Features\r\n\r\n#### üïê **Timestamp Extension Support**\r\n- Support for all three MessagePack timestamp formats per specification:\r\n  - **32-bit timestamp**: Seconds-only for 32-bit unsigned integers\r\n  - **64-bit timestamp**: Nanosecond precision with 34-bit second range\r\n  - **96-bit timestamp**: Full range with signed 64-bit seconds + 32-bit nanoseconds\r\n- Automatic optimal format selection based on value ranges\r\n- Seamless integration with existing serialization/deserialization logic\r\n\r\n#### üß™ **Comprehensive Testing Enhancement**\r\n- Boundary testing for all MessagePack formats (array32, map32, str16/32, bin16/32, ext8/16/32)\r\n- Edge case coverage (NaN/infinity floats, int64/uint64 boundaries, error conditions)\r\n- Format marker verification and Unicode string support\r\n- Memory management validation and timestamp-specific tests\r\n\r\n#### üìö **Documentation Improvements**\r\n- Updated README.md with timestamp usage examples and API documentation\r\n- Added Chinese translation (README_CN.md)\r\n- Enhanced usage examples and error handling documentation\r\n\r\n### Technical Implementation\r\n- Strict adherence to MessagePack timestamp specification (extension type ID -1)\r\n- Nanosecond precision validation (0-999,999,999)\r\n- Full Unix timestamp range support including pre-1970 negative values\r\n- Maintains backward compatibility\r\n\r\n### Breaking Changes\r\nNone. Fully backward-compatible additive functionality.\r\n\r\n### Performance Impact\r\nMinimal. Negligible timestamp support overhead with optimal storage efficiency through automatic format selection.",
      "prerelease": false,
      "published_at": "2025-07-26T11:30:33Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.9",
      "assets": []
    },
    {
      "tag_name": "0.0.8",
      "name": "0.0.8",
      "body": "## What's Changed\r\n* docs: add getty-msgpack to related projects by @LordMZTE in https://github.com/zigcc/zig-msgpack/pull/10\r\n* fix: write array len after array16 && array32 header definitions by @Pix-xiP in https://github.com/zigcc/zig-msgpack/pull/11\r\n\r\n## New Contributors\r\n* @LordMZTE made their first contribution in https://github.com/zigcc/zig-msgpack/pull/10\r\n* @Pix-xiP made their first contribution in https://github.com/zigcc/zig-msgpack/pull/11\r\n\r\n**Full Changelog**: https://github.com/zigcc/zig-msgpack/compare/0.0.7...0.0.8",
      "prerelease": false,
      "published_at": "2025-03-14T17:36:42Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.8",
      "assets": []
    },
    {
      "tag_name": "0.0.7",
      "name": "0.0.7",
      "body": "support zig `0.14.0`\r\n**Full Changelog**: https://github.com/zigcc/zig-msgpack/compare/0.0.6...0.0.7",
      "prerelease": false,
      "published_at": "2025-03-05T12:41:26Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.7",
      "assets": []
    },
    {
      "tag_name": "0.0.6",
      "name": "0.0.6",
      "body": "For the last version of zig 0.13",
      "prerelease": false,
      "published_at": "2025-03-05T12:23:30Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.6",
      "assets": []
    },
    {
      "tag_name": "0.0.5",
      "name": "0.0.5",
      "body": "## What's Changed\r\n* support master version `0.14` and release `0.13.0` by @jinzhongjia in https://github.com/zigcc/zig-msgpack/pull/6\r\n\r\n\r\n**Full Changelog**: https://github.com/zigcc/zig-msgpack/compare/0.0.4...0.0.5",
      "prerelease": false,
      "published_at": "2024-06-09T03:01:03Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.5",
      "assets": []
    },
    {
      "tag_name": "0.0.4",
      "name": "0.0.4",
      "body": "Update `build.zig`\r\n\r\n## What's Changed\r\n* [Nothing]: Update `build.zig` by @jinzhongjia in https://github.com/zigcc/zig-msgpack/pull/5\r\n\r\n\r\n**Full Changelog**: https://github.com/zigcc/zig-msgpack/compare/0.0.3...0.0.4",
      "prerelease": false,
      "published_at": "2024-05-04T12:03:36Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.4",
      "assets": []
    },
    {
      "tag_name": "0.0.3",
      "name": "0.0.3",
      "body": "Just some version update\r\n\r\n**Full Changelog**: https://github.com/zigcc/zig-msgpack/compare/0.0.2...0.0.3",
      "prerelease": false,
      "published_at": "2024-04-22T09:29:40Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.3",
      "assets": []
    },
    {
      "tag_name": "0.0.2",
      "name": "v0.0.2",
      "body": "* Reconstructed zig-msgpack to make the API more concise\r\n* Added support for online documentation",
      "prerelease": false,
      "published_at": "2024-03-10T02:34:14Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.2",
      "assets": []
    },
    {
      "tag_name": "0.0.1",
      "name": "v0.0.1",
      "body": "Supports all MessagePack types(except timestamp)",
      "prerelease": false,
      "published_at": "2024-02-29T09:54:09Z",
      "html_url": "https://github.com/zigcc/zig-msgpack/releases/tag/0.0.1",
      "assets": []
    }
  ],
  "owner_bio": "Zig ËØ≠Ë®Ä‰∏≠ÊñáÁ§æÂå∫",
  "owner_location": "China",
  "owner_blog": "https://ziglang.cc",
  "owner_twitter_username": null,
  "owner_created_at": "2022-07-18T02:02:06Z",
  "homepage": "https://ziglang.cc/zig-msgpack/",
  "license": "MIT",
  "category": "library"
}