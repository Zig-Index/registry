{
  "name": "znvim",
  "owner": "jinzhongjia",
  "repo": "znvim",
  "description": "neovim remote rpc client implementation with zig",
  "type": "package",
  "topics": [
    "neovim",
    "neovim-remote",
    "zig",
    "zig-package"
  ],
  "stars": 25,
  "forks": 2,
  "watchers": 2,
  "updated_at": "2025-10-25T11:14:02Z",
  "dependencies": [
    {
      "name": "zig_msgpack",
      "url": "https://github.com/zigcc/zig-msgpack/archive/refs/tags/0.0.14.tar.gz",
      "hash": "zig_msgpack-0.0.14-evvueBpfAwBSXibTQiU8q43njtWmdnHKPguZASsrZz7k"
    }
  ],
  "minimum_zig_version": "0.15.1",
  "readme": "# znvim\n\nA lightweight Neovim RPC client for Zig that discovers the runtime API via `nvim_get_api_info`, manages transports, and ships a high-level MessagePack helper so application code never needs to touch the raw `zig-msgpack` API.\n\n## Highlights\n\n- **Runtime API discovery** â€“ obtain structured metadata (`ApiInfo`, `ApiFunction`, `ApiParameter`) describing exactly what the connected Neovim instance exposes.\n- **Multiple transports** â€“ talk to Neovim over Unix sockets, TCP, stdio pipes, named pipes on Windows, or auto-spawned `nvim --embed` processes.\n- **Allocator-friendly client** â€“ the caller keeps ownership of allocations and can decide how long payloads live.\n- **MessagePack faÃ§ade** â€“ `znvim.msgpack` wraps `zig-msgpack` with ergonomic constructors (`msgpack.array`, `msgpack.object`, `msgpack.encode`, â€¦) plus type-safe readers (`msgpack.expectString`, `msgpack.asArray`, â€¦).\n- **Examples ready to build** â€“ `zig build examples` produces runnable binaries that demonstrate common workflows.\n\n## Requirements\n\n- Zig 0.15.x\n- A running Neovim instance compiled with `--embed` support (standard builds already have it)\n\n## Installation\n\nAdd the package to your project using `zig fetch`:\n\n```sh\nzig fetch --save https://github.com/jinzhongjia/znvim/archive/main.tar.gz\n```\n\nWire the module in `build.zig`:\n\n```zig\nconst znvim_dep = b.dependency(\"znvim\", .{\n    .target = target,\n    .optimize = optimize,\n});\nconst znvim = znvim_dep.module(\"znvim\");\n\nexe.root_module.addImport(\"znvim\", znvim);\n```\n\n## Quick Start\n\n```zig\nconst std = @import(\"std\");\nconst znvim = @import(\"znvim\");\nconst msgpack = znvim.msgpack;\n\npub fn main() !void {\n    var gpa = std.heap.GeneralPurposeAllocator(.{}){};\n    defer switch (gpa.deinit()) {\n        .ok => {},\n        .leak => std.debug.print(\"warning: leaked allocations\\n\", .{}),\n    };\n    const allocator = gpa.allocator();\n\n    const address = std.process.getEnvVarOwned(allocator, \"NVIM_LISTEN_ADDRESS\") catch {\n        std.debug.print(\"Set NVIM_LISTEN_ADDRESS to your Neovim socket before running.\\n\", .{});\n        return error.MissingAddress;\n    };\n    defer allocator.free(address);\n\n    var client = try znvim.Client.init(allocator, .{ .socket_path = address });\n    defer client.deinit();\n    try client.connect();\n\n    // Ask Neovim to evaluate a small expression.\n    const expr = try msgpack.string(allocator, \"join(['zig', 'nvim'], '-')\");\n    defer msgpack.free(expr, allocator);\n\n    const params = [_]msgpack.Value{expr};\n    const response = try client.request(\"vim_eval\", &params);\n    defer msgpack.free(response, allocator);\n\n    if (msgpack.asString(response)) |result| {\n        std.debug.print(\"Neovim answered: {s}\\n\", .{result});\n    }\n}\n```\n\nLaunch Neovim and point `NVIM_LISTEN_ADDRESS` at the exposed socket:\n\n```sh\nnvim --headless --listen /tmp/nvim.sock &\nexport NVIM_LISTEN_ADDRESS=/tmp/nvim.sock\nzig build examples\n./zig-out/bin/print_api\n```\n\n## Examples\n\n| Example | Description |\n| --- | --- |\n| `print_api.zig` | Connects and prints the first few discovered API functions. |\n| `run_command.zig` | Issues an `nvim_command` notification that writes to `:messages`. |\n| `eval_expression.zig` | Evaluates a Vimscript expression and inspects the returned payload. |\n| `buffer_lines.zig` | Reads the current buffer, replaces its content, then verifies the change. |\n| `api_lookup.zig` | Looks up metadata for a single API function by name. |\n\nBuild all examples in one go with `zig build examples`; binaries are placed under `zig-out/bin/`.\n\n## Documentation\n\nComprehensive documentation is available in the [`doc/`](doc/) directory:\n\n- **[Quick Start](doc/00-quick-start.md)** - Get started in 5 minutes\n- **[Connection Methods](doc/01-connections.md)** - Learn all connection options (Unix Socket, Named Pipe, TCP, ChildProcess, Stdio)\n- **[API Usage](doc/02-api-usage.md)** - Complete guide to calling Neovim APIs with examples\n- **[Event Subscription](doc/03-events.md)** - Handle buffer events, autocommands, and UI events\n- **[Advanced Usage](doc/04-advanced.md)** - Thread safety, memory management, performance optimization\n- **[Code Examples](doc/05-examples.md)** - Real-world examples (file editor, REPL, formatter, etc.)\n- **[Common Patterns](doc/06-patterns.md)** - Best practices and design patterns\n\nðŸ‘‰ **Start here**: [doc/README.md](doc/README.md)\n\n## MessagePack helper overview\n\nThe `znvim.msgpack` namespace aims to be the only interface most users need:\n\n```zig\nconst payload = try msgpack.object(allocator, .{\n    .name = \"my-command\",\n    .enabled = true,\n    .retries = 3,\n});\n\ndefer msgpack.free(payload, allocator);\n\nconst arr = try msgpack.array(allocator, &.{ payload });\nconst parsed = msgpack.expectArray(arr) catch return error.NotArray;\n```\n\nUse `msgpack.encode(allocator, value)` for generic encoding of common Zig types, and the `expect*` / `as*` helpers when decoding responses.\n\n## Development\n\nRun tests:\n\n```sh\nzig build test\n```\n\nGenerate API documentation:\n\n```sh\nzig build docs\n```\n\nThe generated documentation will be in the `zig-out/docs/` directory. Open `zig-out/docs/index.html` in your browser.\n\nRun performance benchmarks:\n\n```sh\nzig build run-benchmark\n```\n\nTo work on the documentation, keep the English `README.md` and the Chinese translation `README.zh.md` in sync.\n\n## License\n\nMIT\n\n---\n\n- [ä¸­æ–‡æ–‡æ¡£](README.zh.md)\n",
  "owner_avatar_url": "https://avatars.githubusercontent.com/u/41784264?u=d300cf8becbfebb495634687c971048a63c07d2a&v=4",
  "releases": [
    {
      "tag_name": "0.0.3",
      "name": "0.0.3",
      "body": "# znvim v0.0.3\r\n\r\n**Release Date:** October 25, 2025\r\n\r\n## Overview\r\n\r\nznvim 0.0.3 represents a major stability and quality milestone, bringing comprehensive multi-threading support, enhanced error recovery, complete cross-platform test coverage, and an upgrade to zig-msgpack 0.0.14 that fixes critical stability issues discovered through fuzzing.\r\n\r\n## Highlights\r\n\r\n### Multi-Threading Support\r\n\r\nFull thread-safe client implementation with comprehensive concurrency testing:\r\n\r\n- Atomic message ID generation (lock-free, tested with 32 threads Ã— 10,000 operations)\r\n- Mutex-protected shared Client usage for concurrent access\r\n- Independent Client instances for per-thread isolation\r\n- Thread-safe read-only operations\r\n- Performance: 24,615 ops/ms throughput (320,000 operations in 13ms)\r\n- New documentation: `THREAD_SAFETY.md` with best practices and migration guide\r\n\r\n### Dependency Upgrade: zig-msgpack 0.0.14\r\n\r\nCritical update addressing recursion depth crashes discovered through fuzzing:\r\n\r\n- Fixed recursion depth crash bug found via fuzzing tests (Signal 9 on random input)\r\n- All 16 fuzzing tests now pass, including full random input tests\r\n- Removed all temporary workarounds\r\n- Complete fuzzing investigation documented in `BUG_REPRODUCTION_REPORT.md`\r\n\r\n### Complete Cross-Platform Test Coverage\r\n\r\nAdded comprehensive unit and integration tests for all transport layers:\r\n\r\n**New Test Suites:**\r\n- ChildProcess transport: 20 unit tests covering initialization, spawning, connection, read/write operations, error handling, and VTable mechanism\r\n- UnixSocket transport: 21 independent unit tests with custom socket server (no Neovim dependency)\r\n- TCP Socket Unix-specific: 18 POSIX-specific tests for BrokenPipe, ConnectionResetByPeer, SO_REUSEADDR, IPv6, and network scenarios\r\n- Protocol layer: 27 comprehensive message/encoder tests for Request/Response/Notification structures and roundtrip validation\r\n- Windows Stdio transport: 13 tests using temporary files for cross-platform compatibility\r\n- Windows Named Pipe: 12 unit tests with custom pipe server plus existing integration tests\r\n\r\n**Cross-Platform Transport Coverage Matrix:**\r\n\r\n| Transport      | Windows | Unix/Linux | macOS | Total Tests |\r\n|----------------|---------|------------|-------|-------------|\r\n| ChildProcess   | 20      | 20         | 20    | 20          |\r\n| UnixSocket     | N/A     | 21         | 21    | 21          |\r\n| WindowsPipe    | 53      | N/A        | N/A   | 53          |\r\n| TCP Socket     | 19      | 26         | 26    | 37          |\r\n| Stdio          | 18      | 21         | 21    | 26          |\r\n| **Total**      | **110** | **108**    | **108**| **157**    |\r\n\r\n### Enhanced Error Recovery\r\n\r\n13 specialized error recovery tests covering:\r\n- Partial message reads and buffering\r\n- Connection drop detection\r\n- Message ID overflow handling\r\n- Type conversion overflow\r\n- Empty and null response handling\r\n\r\n### Boundary Condition Testing\r\n\r\n25 boundary condition tests validating:\r\n- Large data handling (1MB strings, 1000-element arrays)\r\n- Numeric boundaries (max/min integers, special floats: infinity, NaN)\r\n- Empty values (strings, arrays, maps)\r\n- Extreme parameters (1000-character method names, 100 parameters)\r\n- Unicode and binary data\r\n- Mixed-type arrays and deeply nested structures\r\n\r\n## Test Statistics\r\n\r\n| Metric           | Value           |\r\n|------------------|-----------------|\r\n| Test Files       | 41              |\r\n| Test Cases       | 773             |\r\n| Pass Rate        | 100%            |\r\n| Test Code Lines  | 20,000+         |\r\n| Source Code Lines| 3,200           |\r\n| Test/Code Ratio  | 6.25:1          |\r\n| Quality Rating   | A (87/100)      |\r\n\r\n**Platform Distribution:**\r\n- Windows-only tests: ~70 (skipped on Unix)\r\n- Unix/Linux-only tests: ~85 (skipped on Windows)\r\n- Cross-platform tests: ~618 (run on all platforms)\r\n\r\n## Coverage Improvements\r\n\r\n- Core functionality: 100%\r\n- Error recovery: 95%\r\n- Boundary conditions: 90%\r\n- Concurrency: 100%\r\n- Memory safety: 100%\r\n\r\n## New Test Files\r\n\r\n**Concurrency:**\r\n- `concurrency_tests.zig` (11 tests) - Atomic operations, thread safety\r\n- `concurrent_shared_client_tests.zig` (6 tests) - Shared Client with mutex\r\n\r\n**Error Handling:**\r\n- `error_recovery_tests.zig` (13 tests) - Partial reads, timeouts\r\n- `boundary_tests.zig` (25 tests) - Large data, edge cases\r\n\r\n**Transport Layer:**\r\n- `child_process_tests.zig` (20 tests) - ChildProcess unit tests\r\n- `unix_socket_unit_tests.zig` (21 tests) - UnixSocket independent tests\r\n- `tcp_socket_unix_tests.zig` (18 tests) - Unix/POSIX TCP tests\r\n- `stdio_windows_tests.zig` (13 tests) - Windows Stdio tests\r\n- `windows_pipe_unit_tests.zig` (12 tests) - Named pipe unit tests\r\n\r\n**Protocol:**\r\n- `protocol_message_tests.zig` (27 tests) - Message structure and encoding\r\n\r\n**End-to-End:**\r\n- `e2e_concurrent_tests.zig` (3 tests) - Concurrency scenarios\r\n- `e2e_fault_recovery_tests.zig` (17 tests) - Disconnect/reconnect\r\n- `e2e_workflow_tests.zig` (9 tests) - Real editing workflows\r\n- `e2e_long_running_tests.zig` (9 tests) - Sustained operations\r\n- `e2e_large_data_tests.zig` (11 tests) - Large data transfers\r\n\r\n**Fuzzing:**\r\n- `fuzz_manual_tests.zig` (16 tests) - All passing including random input\r\n\r\n## Breaking Changes\r\n\r\nNone. This release maintains full backward compatibility with v0.0.2.\r\n\r\n## Requirements\r\n\r\n- Zig 0.15.x\r\n- Neovim with `--embed` support (standard builds)\r\n\r\n## Installation\r\n\r\n```sh\r\nzig fetch --save https://github.com/jinzhongjia/znvim/archive/v0.0.3.tar.gz\r\n```\r\n\r\n## What's Next\r\n\r\nFuture enhancements planned for upcoming releases:\r\n- Event handling system for buffer events, UI events\r\n- Async/await support for non-blocking operations\r\n- API code generation for type-safe wrappers\r\n- Connection pooling and batch operations\r\n\r\n## Acknowledgments\r\n\r\nSpecial thanks to the zig-msgpack maintainers for the rapid fix of the recursion depth issue discovered through our fuzzing tests.\r\n\r\n---\r\n\r\n**Full Changelog**: v0.0.2...v0.0.3\r\n</markdown>",
      "prerelease": false,
      "published_at": "2025-10-25T04:11:34Z",
      "html_url": "https://github.com/jinzhongjia/znvim/releases/tag/0.0.3",
      "assets": []
    },
    {
      "tag_name": "0.0.2",
      "name": "0.0.2",
      "body": "support zig master (0.14-dev)\r\n\r\n**Full Changelog**: https://github.com/jinzhongjia/znvim/compare/0.0.1...0.0.2",
      "prerelease": false,
      "published_at": "2025-02-21T07:11:11Z",
      "html_url": "https://github.com/jinzhongjia/znvim/releases/tag/0.0.2",
      "assets": []
    },
    {
      "tag_name": "0.0.1",
      "name": "0.0.1",
      "body": "Already basically available",
      "prerelease": false,
      "published_at": "2024-06-08T08:32:14Z",
      "html_url": "https://github.com/jinzhongjia/znvim/releases/tag/0.0.1",
      "assets": []
    }
  ],
  "owner_bio": "Programming is like building blocks",
  "owner_company": null,
  "owner_location": "Singapore",
  "owner_blog": "https://blog.nvimer.org",
  "owner_twitter_username": null,
  "owner_followers": 82,
  "owner_following": 18,
  "owner_created_at": "2018-07-27T10:00:34Z",
  "homepage": "https://jinzhongjia.github.io/znvim/",
  "license": "MIT",
  "category": "library"
}