{
  "name": "ztap",
  "owner": "mnemnion",
  "repo": "ztap",
  "description": "ZTAP: TAP producer for zig build test",
  "type": "package",
  "topics": [
    "tap",
    "testing",
    "zig",
    "zig-package"
  ],
  "stars": 11,
  "forks": 1,
  "watchers": 1,
  "updated_at": "2025-09-25T14:30:25Z",
  "minimum_zig_version": "0.15.1",
  "readme": "# ZTAP\n\nThe [Test Anything Protocol](https://testanything.org/) is a simple,\nvenerable, and widely-used format for reporting the output of tests.\n\nZTAP is a Zig library for running and reporting tests in the TAP 14\nformat.\n\n## Compatibility\n\nZTAP requires Zig 0.14.\n\n## Use\n\nThis can be used as the main unit testing step, or as a custom step.\nInstructions will assume the latter, but are easily adapted for the\nformer case.\n\nAdd to `build.zig.zon` in the usual fashion:\n\n```sh\nzig fetch --save \"https://github.com/mnemnion/ztap/archive/refs/tags/v0.9.2.tar.gz\"\n```\nYou'll need a test runner.  A default one is included, and looks like this:\n\n```zig\nconst std = @import(\"std\");\nconst builtin = @import(\"builtin\");\nconst ztap = @import(\"ztap\");\n\n// This gives TAP-compatible panic handling\npub const panic = std.debug.FullPanic(ztap.ztap_panic);\n\npub fn main() !void {\n    ztap.ztap_test(builtin);\n    std.process.exit(0);\n}\n```\nWhich you could customize, on the off chance that you need that.\n\nDo be sure to exit with `0`, since the protocol interprets non-zero as\na test failure.\n\nNext, set up your `build.zig`.  We'll assume you want to use the\ndefault test runner, and make this a custom step.\n\n```zig\n    // If you want to filter tests, add this.  It works with the stock\n    // unit test runner as well.\n    const test_filters: []const []const u8 = b.option(\n        []const []const u8,\n        \"test-filter\",\n        \"Skip tests that do not match any of the specified filters\",\n    ) orelse &.{};\n\n    const ztap_dep = b.dependency(\"ztap\", .{\n        .target = target,\n        .optimize = optimize,\n    });\n\n    // ZTAP test runner step.\n    const ztap_unit_tests = b.addTest(.{\n        .name = \"ztap-run\",\n        .root_source_file = b.path(\"src/test-root-file.zig\"),\n        .target = target,\n        .optimize = optimize,\n        .filters = test_filters,\n        // With the provided test runner:\n        .test_runner = .{ .path = ztap_dep.namedLazyPath(\"runner\"), .mode = .simple},\n        // Or you can use your own:\n        // .test_runner = .{ .path = b.path(\"src/ztap_custom_runner.zig\"), .mode = .simple },\n    });\n    ztap_unit_tests.root_module.addImport(\"ztap\", ztap_dep.module(\"ztap\"));\n\n    // To put the runner in zig-out etc.\n    b.installArtifact(ztap_unit_tests);\n\n    const run_ztap_tests = b.addRunArtifact(ztap_unit_tests);\n\n    // To always run tests, even if nothing changed, add this:\n    // run_ztap_tests.has_side_effects = true;\n\n    // TAP producers write to stdout.\n    //\n    // To suppress stderr chatter, you can uncomment this:\n\n    // _ = run_ztap_tests.captureStdErr();\n\n    // Just call this \"test\" to make ZTAP the main test runner.\n    const ztap_step = b.step(\"ztap\", \"Run tests with ZTAP\");\n    ztap_step.dependOn(&run_ztap_tests.step);\n    // Otherwise you can set up default tests as well, in the\n    // expected manner.  It's nice to have options.\n```\nThat should do the trick.  See the first link for an example of what to\nexpect in the way of output.\n\n## Use Notes\n\nZTAP is simply an output format for Zig's test system, and no changes\nshould be necessary to use it as such.  If `error.SkipZigTest` is\nreturned, ZTAP will issue the `# Skip` directive.  Zig doesn't support\na TODO for tests (not that it should necessarily), but TAP does, so if\n`error.ZTapTodo` is returned, ZTAP will issue `# Todo`.  Zig's test\nrunner will treat the latter as any other error.  In the event that Zig\nadds a TODO error to the test system, ZTAP will support that also.\n\nThe `ztap_panic` function will add a comment to the TAP output naming\nthe test, and issue the `Bail out!` directive which is proper for a\nfatal error.  It then calls the default panic handler, which does the\naccustomed things using `stderr`.\n\n## Roadmap\n\nZTAP does what it needs to.  There is no visible need for additional\nfunctionality, the library is stable and in use.\n\nThe only contemplated change is in the event that Zig does add a TODO\ntype error to the test system.  In that event, ZTAP will support both,\nwith a deprecation notice for `error.ZTapTodo`, and the custom error\nwill be removed in 1.0.\n\nSpeaking of 1.0, an earlier version of the README suggested that ZTAP\nwould declare 1.0 under conditions which have in fact been achieved.\nHowever, changes to the panic handling in Zig 0.14 required ZTAP to\nmake changes to its public interface.  In recognition of this, ZTAP\nwill not declare a 1.0 edition before Zig itself does.\n\nHowever, the only breaking changes I will countenance are those needed\nto keep up with changes in Zig.  Other than that, consider ZTAP to have\nreached release status.\n\n### Why Though?\n\nEverything speaks TAP.  CI speaks TAP, distros speak TAP, your editor\nspeaks TAP.  If you find yourself wanting to integrate with some or all\nof these things, ZTAP will TAP your Zig.\n\nAlso, if you print to `stdout`, ZTAP will not hang your unit tests.  That\ndoesn't make it a good idea, TAP harnesses ignore what they don't grok,\nbut it can't help things, and it can screw them up.  It does mean that\ntests will complete in the event that `stdout` is printed to.\n",
  "owner_avatar_url": "https://avatars.githubusercontent.com/u/231785?u=8a0cdeb97b0a614b0350536ecd6921ee6166c611&v=4",
  "releases": [
    {
      "tag_name": "v0.9.2",
      "name": "Zig 0.15 compatibility",
      "body": "**Full Changelog**: https://github.com/mnemnion/ztap/compare/v0.9.1...v0.9.2\r\n\r\nAlso makes the one bit of global state in the runner into a\r\n`threadlocal`, which is just good hygiene, and potentially opens the\r\ndoor to a multithreaded TAP runner, although, don't count on this.",
      "prerelease": false,
      "published_at": "2025-09-25T14:35:09Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.9.2",
      "assets": []
    },
    {
      "tag_name": "v0.9.1",
      "name": "ZTAP-provided default test runner",
      "body": "ZTAP now includes a test runner, which can be linked in path form\r\ndirectly to the ZTAP step.  This is now the preferred way to use ZTAP,\r\nsince there's no need to include a separate file in your own program.\r\n\r\nThis is a feature-only update.",
      "prerelease": false,
      "published_at": "2025-05-19T19:55:38Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.9.1",
      "assets": []
    },
    {
      "tag_name": "v0.9.0",
      "name": "Zig 0.14 compatibility",
      "body": "This release makes ztap compatible with the official 0.14 release of\r\nZig.  No new features are added or planned.",
      "prerelease": false,
      "published_at": "2025-03-14T18:34:08Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.9.0",
      "assets": []
    },
    {
      "tag_name": "v0.8.2",
      "name": "Update panic handler",
      "body": "Zig master changed how default panic handlers are called, this is a tracking update which makes ZTAP compatible with that change.",
      "prerelease": false,
      "published_at": "2025-01-27T19:27:49Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.8.2",
      "assets": []
    },
    {
      "tag_name": "v0.8.1-master-rc",
      "name": "Master-branch compatible release",
      "body": "This is v0.8.1, modified to build with the latest release of `zig master`, which have lowercased the names used in `Type`.   \r\n\r\nThis project will switch to tracking `0.14` when released, in the meantime, if you're using recent builds, this is the release you want.",
      "prerelease": false,
      "published_at": "2024-09-13T21:02:37Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.8.1-master-rc",
      "assets": []
    },
    {
      "tag_name": "v0.8.1",
      "name": "ZTAG v0.8.1",
      "body": "Unlikely to change in any essential or API way.",
      "prerelease": false,
      "published_at": "2024-09-12T14:38:17Z",
      "html_url": "https://github.com/mnemnion/ztap/releases/tag/v0.8.1",
      "assets": []
    }
  ],
  "owner_company": null,
  "owner_location": "Eastern Standard Tribe",
  "owner_blog": null,
  "owner_twitter_username": null,
  "owner_followers": 91,
  "owner_following": 24,
  "owner_created_at": "2010-03-27T23:31:39Z",
  "license": "MIT",
  "category": "library"
}