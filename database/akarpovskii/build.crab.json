{
  "name": "build.crab",
  "owner": "akarpovskii",
  "repo": "build.crab",
  "description": "Build and use Rust libraries from Zig",
  "type": "package",
  "topics": [
    "cargo",
    "rust",
    "zig",
    "zig-package"
  ],
  "stars": 54,
  "forks": 7,
  "watchers": 2,
  "updated_at": "2026-02-09T15:57:44Z",
  "minimum_zig_version": "0.15.1",
  "readme": "# build.crab\n\nThin wrapper around Cargo which integrates it with Zig's build system. <br>\nCross-compilation is supported.\n\n## Requirements\n\nPlease see `.minimum_zig_version` field of the `build.zig.zon` file.\n\n## Usage\n\n```sh\nzig fetch --save git+https://github.com/akarpovskii/build.crab\n```\n\nIn `build.zig` (replace `crate` with the name of your crate):\n```zig\nconst build_crab = @import(\"build_crab\");\nconst crate_artifacts = build_crab.addCargoBuild(\n    b,\n    .{\n        .manifest_path = b.path(\"path/to/Cargo.toml\"),\n        // You can pass additional arguments to Cargo\n        .cargo_args = &.{\n            \"--release\",\n            \"--quiet\",\n        },\n    },\n    .{\n        // Set to .Debug to see debug logs,\n        // defaults to the same optimization level as your package.\n        .optimize = .ReleaseSafe,\n    },\n);\n\nmodule.addLibraryPath(crate_artifacts);\nmodule.linkSystemLibrary(\"crate\", .{});\n```\n\nSee [`example`](./example/build.zig) for the other examples.\n\n## Cross-compilation\n\nUse `target` argument to specify the cross-compilation target:\n\n```zig\nconst target = b.standardTargetOptions(.{});\nconst build_crab = @import(\"build_crab\");\nconst crate_artifacts = build_crab.addCargoBuild(\n    b,\n    .{\n        // Cargo params\n    },\n    .{\n        .target = target,\n    },\n);\n```\n\n`build.crab` binaries will still be built for the native target, but it will try its best to convert Zig's target triple to Rust and call `cargo build` with the appropriate `--target` argument.\n\nSee [`rust.zig`](src/rust.zig) and the tests at the bottom to know how the conversion is done.\n\n## Override Rust target\n\nUse `rust_target` from `CargoConfig` to override the `--target` argument passed to `cargo build`:\n\n```zig\nconst target = b.standardTargetOptions(.{});\nconst build_crab = @import(\"build_crab\");\nconst crate_artifacts = build_crab.addCargoBuild(\n    b,\n    .{\n        .rust_target = .{\n            // Override only some parts\n            .override = .{ .vendor = .{ .custom = \"alpine\" } },\n\n            // Or specify the value explicitly\n            // .value = \"x86_64-alpine-linux-musl\",\n        },\n        ...\n    },\n    ...\n);\n```\n\n## Windows\n\n### Toolchain\n\nBy default, Rust on Windows targets MSVC toolchain. This creates additional problems as you have to link against msvcrt, etc.\n\nIf you want to avoid that, you can target windows-gnu. This is the default behavior of `build.crab`.\n\n### Unused symbols\n\nI recommend adding the following parameters to `Cargo.toml`:\n\n```toml\n[profile.release]\nopt-level = \"z\"  # Optimize for size.\nstrip = true\nlto = true\n```\n\nOtherwise, you will have to link some obscure Windows libraries even if you don't use them.\n\nAnd it also makes the size of the rust library smaller.\n\n### Duplicate symbols [obsolete since Zig 0.14.0 / build.crab 0.2.0]\n\nBoth Rust and Zig provide `compiler_rt.lib` with most of the symbols having weak linking, but not `___chkstk` and `___chkstk_ms`.\n\nSo if you want to link against a Rust library that needs these intrinsics, you should somehow resolve the conflict (though I'm not completely sure that it is safe to do).\n\nFor this purpose, `build.crab` provides an additional artifact called `strip_symbols` that repacks `.a` archive removing `.o` files containing conflicting functions (provided by the user).\n\n```zig\nconst crate_lib_path = @import(\"build_crab\").addStripSymbols(b, .{\n    .name = \"libcrate.a\",\n    .archive = b.path(\"path/to/libcrate.a\"),\n    .symbols = &.{\n        \"___chkstk_ms\",\n    },\n});\n\nmodule.addLibraryPath(crate_lib_path.dirname());\nmodule.linkSystemLibrary(\"crate\", .{});\n```\n\nIf you use `addRustStaticlib`, this is already taken care of for you. See the [`buid.zig`](./example/build.zig) for a complete example.\n",
  "owner_avatar_url": "https://avatars.githubusercontent.com/u/21952395?u=f417a9ead1cec0d1ff4b7703a754cbf8dd7ebd8f&v=4",
  "releases": [
    {
      "tag_name": "v0.2.1",
      "name": "v0.2.1",
      "body": "## What's Changed\r\n* Update to Zig 0.15 by @linusg in https://github.com/akarpovskii/build.crab/pull/19\r\n\r\n\r\n**Full Changelog**: https://github.com/akarpovskii/build.crab/compare/v0.2.0...v0.2.1",
      "prerelease": false,
      "published_at": "2025-08-30T06:12:47Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.2.1",
      "assets": []
    },
    {
      "tag_name": "v0.2.0",
      "name": "v0.2.0",
      "body": "## What's Changed\r\n> [!IMPORTANT]\r\n> * Package name changed from `build.crab` to `build_crab` due to the [new package hash format](https://ziglang.org/download/0.14.0/release-notes.html#New-Package-Hash-Format)\r\n* `___chkstk_ms` no longer causes any problems on Windows, removed strip_symbols call in `addRustStaticlib`\r\n* Following the above, `addRustStaticlib` is no longer doing anything useful and is now **deprecated** in favor of `addCargoBuild`\r\n* All directories in dep files are now replaced with the respective lists of files to work around Zig's limitation\r\n* Users can now override every part of the resulting Rust target\r\n* Added support for more targets (wasip1, wasip2, riscv32, and more)\r\n\r\n**Full Changelog**: https://github.com/akarpovskii/build.crab/compare/v0.1.7...v0.2.0",
      "prerelease": false,
      "published_at": "2025-03-05T15:20:35Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.2.0",
      "assets": []
    },
    {
      "tag_name": "v0.1.7",
      "name": "v0.1.7",
      "body": "- Fixed builds for current Zig master (#9)\r\n- Better translation of Tier 2 and Tier 3 targets (#10)",
      "prerelease": false,
      "published_at": "2024-09-16T18:40:35Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.7",
      "assets": []
    },
    {
      "tag_name": "v0.1.6",
      "name": "v0.1.6",
      "body": "* Support crates with multiple artifacts (#7)\r\n  * addCargoBuild now returns a directory containing all the artifacts\r\n* API changes:\r\n  * Removed `name` from `CargoConfig`\r\n  * Removed `add*WithUserOptions` in favor of `add*` functions accepting the options.",
      "prerelease": false,
      "published_at": "2024-07-09T08:12:32Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.6",
      "assets": []
    },
    {
      "tag_name": "v0.1.5",
      "name": "v0.1.5",
      "body": "Fix build on zig master",
      "prerelease": false,
      "published_at": "2024-05-30T16:47:17Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.5",
      "assets": []
    },
    {
      "tag_name": "v0.1.4",
      "name": "v0.1.4",
      "body": "- Cross-compilation, see the [readme](https://github.com/akarpovskii/build.crab/blob/v0.1.4/README.md#cross-compilation)",
      "prerelease": false,
      "published_at": "2024-05-09T09:24:15Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.4",
      "assets": []
    },
    {
      "tag_name": "v0.1.3",
      "name": "v0.1.3",
      "body": "- Now includes utilities to convert target triples from Zig to Rust.\r\n- Fixed `addCargoBuild` using incorrect target on Windows x86\r\n- New helper function `addRustStaticlib` which combines `addCargoBuild` and `stripSybmols` removing `___chkstk_ms` on Windows.",
      "prerelease": false,
      "published_at": "2024-05-08T08:54:29Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.3",
      "assets": []
    },
    {
      "tag_name": "v0.1.2",
      "name": "v0.1.2",
      "body": "New helper function that can be used in build.zig.\r\n\r\nSee the updated [usage examples](https://github.com/akarpovskii/build.crab?tab=readme-ov-file#usage) and [build.zig](https://github.com/akarpovskii/build.crab/blob/main/build.zig#L70) for more info.",
      "prerelease": false,
      "published_at": "2024-05-06T13:13:50Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.2",
      "assets": []
    },
    {
      "tag_name": "v0.1.1",
      "name": "v0.1.1",
      "body": "### New `strip_symbols` binary for Windows.\r\nBoth Zig and Rust define `___chkstk_ms` with strong linking leading to \"duplicate symbols\" error during the link stage.\r\n\r\nThe release adds a new `strip_symbols` artifact which strips conflicting symbols from Rust libraries thus making the link successful.\r\nSee the updated [`README.md`](https://github.com/akarpovskii/build.crab/tree/main?tab=readme-ov-file#windows) for more details.",
      "prerelease": false,
      "published_at": "2024-05-03T22:36:54Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.1",
      "assets": []
    },
    {
      "tag_name": "v0.1.0",
      "name": "v0.1.0",
      "body": "Hello world",
      "prerelease": false,
      "published_at": "2024-05-02T16:57:49Z",
      "html_url": "https://github.com/akarpovskii/build.crab/releases/tag/v0.1.0",
      "assets": []
    }
  ],
  "owner_company": null,
  "owner_location": null,
  "owner_blog": null,
  "owner_twitter_username": null,
  "owner_followers": 9,
  "owner_following": 0,
  "owner_created_at": "2016-09-02T11:37:00Z",
  "license": "MIT",
  "category": "library"
}