name: Trigger Site Deploy

on:
  push:
    branches:
      - main
    paths:
      - 'repositories/**/*.json'

jobs:
  trigger-deploy:
    name: Trigger Main Site Deployment
    runs-on: ubuntu-latest
    
    steps:
      - name: Trigger deployment on main site
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.GH_TOKEN }}
          repository: Zig-Index/zig-index.github.io
          event-type: registry-updated
          client-payload: '{"ref": "${{ github.ref }}", "sha": "${{ github.sha }}"}'

      - name: Log trigger
        run: |
          echo "ðŸš€ Triggered deployment on zig-index.github.io"
          echo "Registry commit: ${{ github.sha }}"
          echo "Triggered by: ${{ github.actor }}"
